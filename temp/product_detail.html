{% extends 'base.html' %}
{% load static %}
{% block title %}MedPlus - {{ product.name }}{% endblock %}

{% block content %}
<section class="product-page">
    <div class="product-container">
        <!-- Left: Images -->
        <div class="product-gallery">
            <div class="thumbnail-list">
                {% if product.image %}
                <img src="{{ product.image.url }}" alt="{{ product.name }} 1" class="thumb active">
                {% endif %}
                {% if product.image2 %}
                <img src="{{ product.image2.url }}" alt="{{ product.name }} 2" class="thumb">
                {% endif %}
                {% if product.image3 %}
                <img src="{{ product.image3.url }}" alt="{{ product.name }} 3" class="thumb">
                {% endif %}
                {% if product.image4 %}
                <img src="{{ product.image4.url }}" alt="{{ product.name }} 4" class="thumb">
                {% endif %}
            </div>

            <div class="main-image">
                <img id="mainImage" src="{{ product.image.url }}" alt="{{ product.name }}">
            </div>
        </div>

        <!-- Right: Product Info -->
        <div class="product-info">
            <p class="category">
                {% for cat in product.categories.all %}
                {{ cat.name }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
            </p>

            <h2 class="product-title">{{ product.name }}</h2>

            <div class="price-section">
                <span class="price">‚Çπ{{ product.selling_price }}</span>
                {% if product.mrp %}
                <span class="old-price">‚Çπ{{ product.mrp }}</span>
                {% endif %}
                {% if product.discount_percent %}
                <span class="discount">Save {{ product.discount_percent }}%</span>
                {% endif %}
            </div>

            {% if product.stock > 0 %}
            <p class="availability in-stock">In Stock</p>
            {% else %}
            <p class="availability out-of-stock">Out of Stock</p>
            {% endif %}

            {% if product.medicine_type == 'LIQUID' %}
            <div class="quantity-section">
                <h4>Select Quantity</h4>
                <div class="quantity-options">
                    {% for option in product.quantity_options.all %}
                    <button class="quantity-btn">{{ option.label }}</button>
                    {% empty %}
                    <p>No quantity options available for this product.</p>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <!-- <div class="quantity-section">
                <h4>Pack Details</h4>
                <p><strong>Pack:</strong> 1</p>
            </div> -->
            {% endif %}

            <div class="offer-timer">
                <h5>Hurry up! Offer ends in</h5>
                <div id="countdown">
                    <div><span id="days">02</span>
                        <p>Days</p>
                    </div>
                    <div><span id="hours">06</span>
                        <p>Hours</p>
                    </div>
                    <div><span id="minutes">47</span>
                        <p>Minutes</p>
                    </div>
                    <div><span id="seconds">27</span>
                        <p>Seconds</p>
                    </div>
                </div>
            </div>

            <div class="action-section" data-is-authenticated="{{ request.user.is_authenticated|yesno:'true,false' }}"
                data-login-url="{% url 'login' %}" data-current-url="{{ request.path }}">

                <!-- Select Quantity -->
                <div class="product-option">
                    <h4 class="section-title">Select Quantity</h4>
                    <div class="quantity-options">
                        {% if product.medicine_type == "LIQUID" or product.medicine_type == "SYRUP" %}
                        <label>
                            <input type="radio" name="product-size" value="100ml" checked>
                            100 ml
                        </label>
                        <label>
                            <input type="radio" name="product-size" value="250ml">
                            250 ml
                        </label>
                        <label>
                            <input type="radio" name="product-size" value="500ml">
                            500 ml
                        </label>
                        {% elif product.medicine_type == "TABLET" or product.medicine_type == "CAPSULE" %}
                        <label>
                            <input type="radio" name="product-size" value="10pcs" checked>
                            10 pcs
                        </label>
                        <label>
                            <input type="radio" name="product-size" value="20pcs">
                            20 pcs
                        </label>
                        <label>
                            <input type="radio" name="product-size" value="30pcs">
                            30 pcs
                        </label>
                        {% elif product.medicine_type == "CREAM" %}
                        <label>
                            <input type="radio" name="product-size" value="30g" checked>
                            30 g
                        </label>
                        <label>
                            <input type="radio" name="product-size" value="50g">
                            50 g
                        </label>
                        <label>
                            <input type="radio" name="product-size" value="100g">
                            100 g
                        </label>
                        {% elif product.medicine_type == "INJECTION" %}
                        <label>
                            <input type="radio" name="product-size" value="1vial" checked>
                            1 vial
                        </label>
                        <label>
                            <input type="radio" name="product-size" value="2vials">
                            2 vials
                        </label>
                        {% else %}
                        <label>
                            <input type="radio" name="product-size" value="100g" checked>
                            100 g
                        </label>
                        <label>
                            <input type="radio" name="product-size" value="250g">
                            250 g
                        </label>
                        {% endif %}
                    </div>
                </div>

                <!-- Quantity Increment -->
                <div class="product-quantity">
                    <h4 class="section-title">Quantity</h4>
                    <div class="quantity-control">
                        <!-- <button class="qty-btn" id="decreaseQty">‚àí</button> -->
                        <input type="number" id="productQty" value="1" min="1">
                        <!-- <button class="qty-btn" id="increaseQty">+</button> -->
                        <button class="add-cart" data-product-id="{{ product.id }}" onclick="addToCart(this)"> Add to
                            Cart</button>
                    </div>
                </div>

                <!-- Buy Now -->
                <button class="buy-now"
                    onclick="window.location.href='/checkout?product_id={{ product.id }}&qty=' + document.getElementById('productQty').value">
                    Buy it Now
                </button>
            </div>

            <div class="delivery-info">
                <div class="delivery-section">
                    <h4><i class="fa-solid fa-truck"></i> Expected delivery date:</h4>
                    <p>20 Nov ‚Ä¢ Usually ready in 2-3 days.</p>
                </div>
                <hr>
                <div class="pickup-section">
                    <h4><i class="fa-solid fa-location-dot"></i> Pickup available at:</h4>
                    <p>41, Peabody str. Nashville TN 37210, United States.</p>
                </div>
            </div>

        </div>
    </div>
</section>

<!-- Product Specification Accordion -->
<section class="product-specs">
    <div class="specs-left">
        <h2 class="specs-heading">Product Specifications</h2>

        <div class="accordion">
            <div class="accordion-item">
                <button class="accordion-btn">Details <i class="fa-solid fa-chevron-down"></i></button>
                <div class="accordion-content">
                    <p>{{ product.description }}</p>
                </div>
            </div>

            <div class="accordion-item">
                <button class="accordion-btn">Benefits <i class="fa-solid fa-chevron-down"></i></button>
                <div class="accordion-content">
                    <p>{{ product.benefits|default:"Improves hydration and energy levels." }}</p>
                </div>
            </div>

            <div class="accordion-item">
                <button class="accordion-btn">How to use <i class="fa-solid fa-chevron-down"></i></button>
                <div class="accordion-content">
                    <p>{{ product.usage|default:"Mix one scoop with water daily or as directed." }}</p>
                </div>
            </div>

            <div class="accordion-item">
                <button class="accordion-btn">Ingredients <i class="fa-solid fa-chevron-down"></i></button>
                <div class="accordion-content">
                    <p>{{ product.ingredients|default:"Electrolytes, natural flavors, glucose, minerals." }}</p>
                </div>
            </div>
        </div>
    </div>

    <div class="specs-right">
        <img src="{{ product.image.url }}" alt="{{ product.name }}">
    </div>
</section>

<!-- FAQ + Reviews -->
<section class="faq-reviews">
    <!-- Left: FAQs -->
    <div class="faq-section">
        <h2 class="faq-heading">Frequently Asked Questions</h2>
        <div class="accordion faq-accordion">
            <div class="accordion-item">
                <button class="accordion-btn">What makes Mediva supplements different from others? <i
                        class="fa-solid fa-chevron-down"></i></button>
                <div class="accordion-content">
                    <p>Mediva supplements are made with clean, science-backed ingredients and no unnecessary fillers.
                    </p>
                </div>
            </div>

            <div class="accordion-item">
                <button class="accordion-btn">Are your supplements safe to take every day? <i
                        class="fa-solid fa-chevron-down"></i></button>
                <div class="accordion-content">
                    <p>Yes, they‚Äôre safe for daily use and formulated with high-quality, natural ingredients.</p>
                </div>
            </div>

            <div class="accordion-item">
                <button class="accordion-btn">Do you offer international shipping? <i
                        class="fa-solid fa-chevron-down"></i></button>
                <div class="accordion-content">
                    <p>Yes, we ship globally so everyone can enjoy Mediva‚Äôs quality supplements.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Right: Reviews -->
    <div class="review-section">
        <h2 class="review-heading">Customer Reviews</h2>
        <div class="review-card">
            <p class="review-stars">‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚òÜ</p>
            <p class="review-text">‚ÄúI‚Äôve tried a lot of brands, but Mediva is the first that actually helped with my
                fatigue.‚Äù</p>
            <img src="/static/img/default-user.png" alt="User" class="review-user">
            <p class="review-name">‚Äî Sarah L.</p>
        </div>

        <div class="review-card">
            <p class="review-stars">‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è</p>
            <p class="review-text">‚ÄúAbsolutely love it! My energy levels are so much better now.‚Äù</p>
            <img src="/static/img/default-user.png" alt="User" class="review-user">
            <p class="review-name">‚Äî Kevin M.</p>
        </div>
    </div>
</section>

<!-- You Might Also Like -->
<section class="related-products">
    <h2>You Might Also Like</h2>
    <div class="related-grid">
        {% for product in products %}
        <div class="related-card">
            {% if product.image %}
            <img src="{{ product.image.url }}" alt="{{ product.name }}">
            {% endif %}
            <h3>{{ product.name|truncatewords:3 }}</h3>
            <p>‚Çπ{{ product.mrp }}</p>
            <a href="{% url 'product_detail' product.id %}" class="view-btn">View Product</a>
        </div>
        {% endfor %}
    </div>
</section>

<script>
    const thumbnails = document.querySelectorAll('.thumb');
    const mainImage = document.getElementById('mainImage');

    thumbnails.forEach(thumb => {
        thumb.addEventListener('click', () => {
            // Remove 'active' from all thumbnails
            thumbnails.forEach(t => t.classList.remove('active'));

            // Add 'active' to clicked thumbnail
            thumb.classList.add('active');

            // Update main image
            mainImage.style.opacity = '0';
            setTimeout(() => {
                mainImage.src = thumb.src;
                mainImage.style.opacity = '1';
            }, 200);
        });
    });
</script>

<script>
    // Set your offer end date (example: 3 days from now)
    const offerEndDate = new Date();
    offerEndDate.setDate(offerEndDate.getDate() + 3); // 3 days from now

    function updateCountdown() {
        const now = new Date().getTime();
        const distance = offerEndDate - now;

        const countdownContainer = document.getElementById("countdown");

        if (distance <= 0) {
            countdownContainer.innerHTML = "<p>Offer has ended üò¢</p>";
            clearInterval(timerInterval);
            return;
        }

        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

        countdownContainer.innerHTML = `
            <div class="time-box"><span>${String(days).padStart(2, '0')}</span><p>Days</p></div>
            <span class="colon">:</span>
            <div class="time-box"><span>${String(hours).padStart(2, '0')}</span><p>Hours</p></div>
            <span class="colon">:</span>
            <div class="time-box"><span>${String(minutes).padStart(2, '0')}</span><p>Minutes</p></div>
            <span class="colon">:</span>
            <div class="time-box"><span>${String(seconds).padStart(2, '0')}</span><p>Seconds</p></div>
        `;
    }

    // Update every second
    const timerInterval = setInterval(updateCountdown, 1000);
    updateCountdown();
</script>

<script>
    // Generic accordion handler
    function setupAccordion(containerSelector) {
        const container = document.querySelector(containerSelector);
        if (!container) return;

        const buttons = container.querySelectorAll(".accordion-btn");

        buttons.forEach(btn => {
            btn.addEventListener("click", () => {
                const content = btn.nextElementSibling;

                // Close others in same container
                container.querySelectorAll(".accordion-content").forEach(item => {
                    if (item !== content) {
                        item.style.maxHeight = null;
                        item.previousElementSibling.classList.remove("active");
                        item.classList.remove("open");
                    }
                });

                // Toggle current one
                btn.classList.toggle("active");
                if (content.style.maxHeight) {
                    content.style.maxHeight = null;
                    content.classList.remove("open");
                } else {
                    content.style.maxHeight = content.scrollHeight + "px";
                    content.classList.add("open");
                }
            });
        });
    }

    // Initialize both accordions separately
    setupAccordion(".accordion");       // For Product Specifications
    setupAccordion(".faq-accordion");   // For FAQ section
</script>

{% endblock %}